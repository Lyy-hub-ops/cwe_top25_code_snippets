njs_inline njs_bool_t
njs_dump_empty(njs_json_stringify_t *stringify, njs_json_state_t *state,
    njs_chb_t *chain, njs_bool_t sep_position)
{
    double   key, prev;
    int64_t  diff;

    if (!state->array || state->fast_array) {
        return 0;
    }

    if (sep_position) {
        key = njs_key_to_index(state->key);
        prev = (state->index > 1) ? njs_key_to_index(&state->key[-1]) : -1;

    } else {
        key = state->length;
        prev = (state->index > 0) ? njs_key_to_index(state->key) : -1;
    }

    if (isnan(key)) {
        key = state->length;
    }

    diff = key - prev;

    if (diff > 1) {
        if (sep_position == 0 && state->keys->length) {
            njs_chb_append_literal(chain, ",");
            njs_json_stringify_indent(stringify, chain, 1);
        }

        njs_chb_sprintf(chain, 64, "<%L empty items>", diff - 1);
        state->written = 1;

        if (sep_position == 1 && state->keys->length) {
            njs_chb_append_literal(chain, ",");
            njs_json_stringify_indent(stringify, chain, 1);
        }
    }

    return 1;
}