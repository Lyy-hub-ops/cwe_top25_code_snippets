int
capture_online(const char *dev)
{
    capture_info_t *capinfo;

    //! Error string
    char errbuf[PCAP_ERRBUF_SIZE];

    // Create a new structure to handle this capture source
    if (!(capinfo = sng_malloc(sizeof(capture_info_t)))) {
        fprintf(stderr, "Can't allocate memory for capture data!\n");
        return 1;
    }

    // Try to find capture device information
    if (pcap_lookupnet(dev, &capinfo->net, &capinfo->mask, errbuf) == -1) {
        capinfo->net = 0;
        capinfo->mask = 0;
    }

    // Open capture device
    capinfo->handle = pcap_create(dev, errbuf);
    if (capinfo->handle == NULL) {
        fprintf(stderr, "Couldn't open device %s: %s\n", dev, errbuf);
        return 2;
    }

    if (pcap_set_snaplen(capinfo->handle, MAXIMUM_SNAPLEN) != 0) {
        fprintf(stderr, "Error setting snaplen on %s: %s\n", dev, pcap_geterr(capinfo->handle));
        return 2;
    }

    if (pcap_set_promisc(capinfo->handle, 1) != 0) {
        fprintf(stderr, "Error setting promiscuous mode on %s: %s\n", dev, pcap_geterr(capinfo->handle));
        return 2;
    }

    if (pcap_set_timeout(capinfo->handle, 1000) != 0) {
        fprintf(stderr, "Error setting capture timeout on %s: %s\n", dev, pcap_geterr(capinfo->handle));
        return 2;
    }

    if (pcap_set_buffer_size(capinfo->handle, capture_cfg.pcap_buffer_size * 1024 * 1024) != 0) {
        fprintf(stderr, "Error setting capture buffer size on %s: %s\n", dev, pcap_geterr(capinfo->handle));
        return 2;
    }

    if (pcap_activate(capinfo->handle) < 0) {
        fprintf(stderr, "Couldn't activate capture: %s\n", pcap_geterr(capinfo->handle));
        return 2;
    }

    // Set capture thread function
    capinfo->capture_fn = capture_thread;

    // Store capture device
    capinfo->device = dev;
    capinfo->ispcap = true;

    // Get datalink to parse packets correctly
    capinfo->link = pcap_datalink(capinfo->handle);

    // Check linktypes sngrep knowns before start parsing packets
    if ((capinfo->link_hl = datalink_size(capinfo->link)) == -1) {
        fprintf(stderr, "Unable to handle linktype %d\n", capinfo->link);
        return 3;
    }

    // Create Vectors for IP and TCP reassembly
    capinfo->tcp_reasm = vector_create(0, 10);
    capinfo->ip_reasm = vector_create(0, 10);

    // Add this capture information as packet source
    capture_add_source(capinfo);

    return 0;
}